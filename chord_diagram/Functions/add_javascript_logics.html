<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
</head>

<body>
    <script>
        function updateKeys(obj) {
            const variations = ["dob", "birth"];
            const zipVariations = ["zip", "Zip", "ZIP"];
            const updatedKey = "CalendarYearBirth";
            const updatedGenderKey = "Gender";
            const updatedZipkey = "Zip3";
            const updatedEmployekey = "Employee";


            for (const key in obj) {

                const lowerCaseKey = key.toLowerCase();

                for (const variation of variations) {
                    if (lowerCaseKey.includes(variation.toLowerCase())) {



                        if (key === updatedKey) {
                            let dateOfBirth;  
                            if (obj[key].length > 4 && isNumericString(obj[key])) {
                                 dateOfBirth = convertSerialToDate(obj[key])
                                // console.log(obj[key], "here is the key", dateOfBirth)

                            }

                            else {
                                 dateOfBirth = obj[key];
                                
                            }

                            let year = extractYear(dateOfBirth);
                            if (!year) {

                                year = extractYearFromDate(dateOfBirth);
                            }
                            obj[updatedKey] = year;
                        } else {
let dateOfBirth ;
                            if (obj[key].length > 4 && isNumericString(obj[key])) {
                                 dateOfBirth = convertSerialToDate(obj[key])
                                console.log(obj[key], "here is the key", convertSerialToDate(obj[key]))

                            }
                            else {
                                 dateOfBirth = obj[key];
                            }

;
                            let year = extractYear(dateOfBirth);
                            if (!year) {
                                year = extractYearFromDate(dateOfBirth);
                            }

                            obj[updatedKey] = year;
                            delete obj[key];
                        }
                        break; // Assuming only one matching key should be updated
                    }
                }

                if (lowerCaseKey === "gender" || lowerCaseKey === "sex") {
                    if (key != updatedGenderKey) {
                        obj[updatedGenderKey] = obj[key];
                        delete obj[key];
                    }
                    const genderValue = obj[updatedGenderKey].toLowerCase();
                    if (genderValue.includes("female") || genderValue.includes("f")) {
                        obj[updatedGenderKey] = "F";
                    } else if (
                        genderValue.includes("male") ||
                        genderValue.includes("m")
                    ) {
                        obj[updatedGenderKey] = "M";
                    } else {
                        obj[updatedGenderKey] = "Unknown";
                    }
                }



                if (lowerCaseKey.includes("zip")) {
                    if (key !== updatedZipkey) {
                        obj[updatedZipkey] = obj[key];
                        delete obj[key];
                    }

                    if (isNumericString(obj[updatedZipkey])) {

                        obj[updatedZipkey] =
                            obj[updatedZipkey].length >= 1
                                ? obj[updatedZipkey].slice(0, 3)
                                : "Unknown";
                    }
                    else {
                        obj[updatedZipkey] = "Unknown";
                    }
                }
                if (lowerCaseKey === "employee" || lowerCaseKey === "employe") {
                    if (key != updatedEmployekey) {
                        obj[updatedEmployekey] = obj[key];
                        delete obj[key];
                    }

                    const employeeValue = obj[updatedEmployekey].toLowerCase();

                    if (employeeValue.length > 2) {
                        if (employeeValue.includes("family")) {
                            obj[updatedEmployekey] = "F";
                        } else if (employeeValue === "only") {
                            obj[updatedEmployekey] = "EE";
                        } else if (
                            employeeValue.includes("spouse") ||
                            employeeValue.includes("partner")
                        ) {
                            obj[updatedEmployekey] = "ES";
                        } else if (employeeValue.includes("child")) {
                            obj[updatedEmployekey] = "EC";
                        } else {
                            obj[updatedEmployekey] = "Unknown";
                        }
                    }
                }
            }
            return obj;
        }
        function extractYearFromDate(dateString) {
            const date = new Date(dateString);

            const year = date.getFullYear();
            return year;
        }
        function extractYear(dateString) {
            if (typeof dateString === "string") {
                const numericalYearMatch = dateString.match(/\b\d{4}\b/);

                if (numericalYearMatch) {
                    return numericalYearMatch[0];
                } else {
                    const date = new Date(dateString);

                    if (!isNaN(date)) {
                        return date.getFullYear();
                    } else {
                        return null;
                    }
                }
            } else {
                return dateString; // Return the same value if not a string
            }
        }



        function isNumericString(str) {
            return /^\d+$/.test(str);
        }

        function hasUnknownValue(obj) {
            for (const key in obj) {
                if (obj[key] === "Unknown") {
                    return true;
                }
            }
            return false;
        }
        function convertSerialToDate(serialNumberStr) {
            // Convert the serial number string to a number
            var serialNumber = parseInt(serialNumberStr);

            // Convert serial number to milliseconds since epoch
            var millisecondsSinceEpoch = (serialNumber - 1) * 24 * 60 * 60 * 1000;

            // Create a new Date object
            var date = new Date(millisecondsSinceEpoch + new Date('1899-12-30').getTime());

            // Extract the date components
            var day = date.getDate();
            var month = date.getMonth() + 1; // Month is zero-indexed, so add 1
            var year = date.getFullYear();

            // Format the date
            var formattedDate = month + '/' + day + '/' + year;

            return formattedDate;
        }



        const objects = [
            {
                CalendarYearBirth: "12/24/1967",
                sex: "nmale",
                Zip3: '12345',
                employe: "partner",
            },
            {
                DOB: "12/24/1967",
                gender: "m",
                ZIP2: '12313131',
                Employee: "F",
            },
        ];

        const objects2 =
            [
                {
                    "CalendarYearBirth": 24830,
                    "Gender": "M",
                    "Zip3": 100,
                    "Employee": "ES"
                },
                {
                    "CalendarYearBirth": 25554,
                    "Gender": "F",
                    "Zip3": 107,
                    "Employee": "EC"
                },
                {
                    "CalendarYearBirth": 25591,
                    "Gender": "F",
                    "Zip3": 912,
                    "Employee": "EC"
                },
                {
                    "CalendarYearBirth": 25591,
                    "Gender": "M",
                    "Zip3": 750,
                    "Employee": "EC"
                },
                {
                    "CalendarYearBirth": 25591,
                    "Gender": "M",
                    "Zip3": 330,
                    "Employee": "EC"
                },
                {
                    "CalendarYearBirth": 1990,
                    "Gender": "F",
                    "Zip3": 600,
                    "Employee": "EC"
                },
                {
                    "CalendarYearBirth": 1991,
                    "Gender": "F",
                    "Zip3": 110,
                    "Employee": "EC"
                },
                {
                    "CalendarYearBirth": 1992,
                    "Gender": "M",
                    "Zip3": 760,
                    "Employee": "EC"
                },
                {
                    "CalendarYearBirth": 1993,
                    "Gender": "F",
                    "Zip3": 335,
                    "Employee": "ES"
                },
                {
                    "CalendarYearBirth": 1994,
                    "Gender": "M",
                    "Zip3": 605,
                    "Employee": "EE"
                }
            ]
        const objectsToString = objects2.map(obj => {
            const newObj = {};
            for (const key in obj) {
                newObj[key] = String(obj[key]);
            }
            return newObj;
        });



        const updatedObjects = objectsToString.map(updateKeys);
        console.log(updatedObjects);






    </script>
</body>

</html>