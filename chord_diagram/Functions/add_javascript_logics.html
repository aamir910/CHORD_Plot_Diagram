<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
</head>

<body>
    <script>
        function updateKeys(obj) {
            const variations = ["dob", "birth"];
            const zipVariations = ["zip", "Zip", "ZIP"];

            const updatedKey = "CalendarYearBirth";
            const updatedGenderKey = "Gender";
            const updatedZipkey = "Zip3";

            const updatedEmployekey = "Employee";

            for (const key in obj) {
                const lowerCaseKey = key.toLowerCase();

                for (const variation of variations) {
                    if (lowerCaseKey.includes(variation.toLowerCase())) {
                        const dateOfBirth = obj[key];
                        let year = extractYear(dateOfBirth);
                        if (!year) {
                            year = extractYearFromDate(dateOfBirth);
                        }
                        obj[updatedKey] = year;
                        delete obj[key];
                        break; // Assuming only one matching key should be updated
                    }
                }

                if (lowerCaseKey === "gender" || lowerCaseKey === "sex") {
                    if (key != updatedGenderKey) {
                        obj[updatedGenderKey] = obj[key];
                        delete obj[key];
                    }
                    const genderValue = obj[updatedGenderKey].toLowerCase();
                    if (genderValue.includes("female") || genderValue.includes("f")) {
                        obj[updatedGenderKey] = "F";
                    } else if (
                        genderValue.includes("male") ||
                        genderValue.includes("m")
                    ) {
                        obj[updatedGenderKey] = "M";
                    } else {
                        obj[updatedGenderKey] = "Unknown";
                    }
                }


                if (lowerCaseKey.includes("zip")) {
                    if (key != updatedKey) {
                        obj[updatedZipkey] = obj[key];
                        delete obj[key];
                    }


                    if (isNumericString(obj[updatedZipkey])) {

                        obj[updatedZipkey] = obj[updatedZipkey].length >= 3 ? obj[updatedZipkey].slice(0, 3) : "Unknown";
                    }
                    else {
                        obj[updatedZipkey] = "Unknown";
                    }
                }



                if (
                    (lowerCaseKey === "employee") ||
                    lowerCaseKey === "employe"
                ) {
                    if (key != updatedEmployekey) {
                        obj[updatedEmployekey] = obj[key];
                        delete obj[key];
                    }


                    const employeeValue = obj[updatedEmployekey].toLowerCase();

                    if (employeeValue.length > 2) {
                        if (employeeValue.includes("family")) {
                            obj[updatedEmployekey] = "F";
                        } else if (employeeValue === "only") {
                            obj[updatedEmployekey] = "EE";
                        } else if (employeeValue.includes("spouse") || employeeValue.includes("domestic partner")) {
                            obj[updatedEmployekey] = "ES";
                        } else if (employeeValue.includes("child")) {
                            obj[updatedEmployekey] = "EC";
                        }
                        else{
                            obj[updatedEmployekey] = "Unknown";
                        }
                    }


                }
            }
            return obj;
        }
        function extractYearFromDate(dateString) {
            const date = new Date(dateString);
            const year = date.getFullYear();
            return year;
        }
        function extractYear(dateString) {
            const numericalYearMatch = dateString.match(/\b\d{4}\b/);
            if (numericalYearMatch) {
                return numericalYearMatch[0];
            } else {
                const date = new Date(dateString);
                if (!isNaN(date)) {
                    return date.getFullYear();
                } else {
                    return null;
                }
            }
        }


        function isNumericString(str) {
            return /^\d+$/.test(str);
        }

        const objects = [
            {
                BirthData: "1990-01-01",
                gender: "nMale",
                zip5: "12345po",
                employe: "only",
            },
            {
                DOB: "02-15-1985",
                gender: "m",
                ZIP2: "1231031313131313131313131",
                Employee: "ES",
            },
        ];

        const updatedObjects = objects.map(updateKeys);

        console.log(updatedObjects);
        // Function to check if any value in an object is "Unknown"
function hasUnknownValue(obj) {
    for (const key in obj) {
        if (obj[key] === "Unknown") {
            return true;
        }
    }
    return false;
}
const filteredObjects = updatedObjects.filter(obj => !hasUnknownValue(obj));

console.log(filteredObjects);


    </script>
</body>

</html>